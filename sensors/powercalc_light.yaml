################################################################################
### Calculate estimated power consumption of lights and other appliances     ###
### https://github.com/bramstroker/homeassistant-powercalc                   ###
################################################################################

################################################################################
### Schlafzimmer: 4 Hue lights                                               ###
################################################################################
  - platform: powercalc
    entity_id: light.white_schlafzimmer_1
    name: 'White - Schlafzimmer - 1 - Power'

  - platform: powercalc
    entity_id: light.white_schlafzimmer_2
    name: 'White - Schlafzimmer - 2 - Power'

  - platform: powercalc
    entity_id: light.white_schlafzimmer_3
    name: 'White - Schlafzimmer - 3 - Power'

  - platform: powercalc
    entity_id: light.white_schlafzimmer_4
    name: 'White - Schlafzimmer - 4 - Power'

################################################################################
### Treppenhaus: 4 Hue lights                                                ###
################################################################################
  - platform: powercalc
    entity_id: light.ambiance_treppenhaus_oo
    name: 'Ambiance - Treppenhaus - OO - Power'

  - platform: powercalc
    entity_id: light.ambiance_treppenhaus_ou
    name: 'Ambiance - Treppenhaus - OU - Power'

  - platform: powercalc
    entity_id: light.ambiance_treppenhaus_uo
    name: 'Ambiance - Treppenhaus - UO - Power'

  - platform: powercalc
    entity_id: light.ambiance_treppenhaus_uu
    name: 'Ambiance - Treppenhaus - UU - Power'

################################################################################
### Arbeitszimmer: 3 Hue lights                                              ###
################################################################################
  - platform: powercalc
    entity_id: light.hue_play_1
    name: 'Hue Play - 1 - Power'

  - platform: powercalc
    entity_id: light.hue_play_2
    name: 'Hue Play - 2 - Power'

  - platform: powercalc
    entity_id: light.hue_go_obergeschoss
    name: 'Hue Go - Obergeschoss - Power'

################################################################################
### Eingang:                                                           ###
################################################################################
  - platform: powercalc
    entity_id: light.ambiance_eingang_vorne
    name: 'Ambiance - Eingang - Vorne - Power'

  - platform: powercalc
    entity_id: light.ambiance_eingang_mitte
    name: 'Ambiance - Eingang - Mitte - Power'

  - platform: powercalc
    entity_id: light.ambiance_eingang_hinten
    name: 'Ambiance - Eingang - Hinten - Power'

################################################################################
### Gästezimemr:                                                           ###
################################################################################
  - platform: powercalc
    entity_id: light.white_gastezimmer
    name: 'White - Gästezimmer - Power'



# Calculate all the consumed power from lights
  - platform: template
    sensors:
      lights_total_power:
        friendly_name: All light power
        unit_of_measurement: W
        icon_template: mdi:transmission-tower
        value_template: >
          {{ expand('group.lights_total_power') 
          | rejectattr('state', 'in', ['unavailable', 'unknown'])
          | map(attribute='state') | map('float') | sum | round(2) }}

# Riemann Integration to get total consumed power
  - platform: integration
    source: sensor.lights_total_power
    name: lights_total_consumption
    unit_prefix: k
    round: 2
